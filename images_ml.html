<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Medical Image Processing: Preparing Images for Machine Learning</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png"><link rel="manifest" href="site.webmanifest"><link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-danger">
          <abbr title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
              Pre-Alpha
            </a>
            <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/images_ml.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Medical Image Processing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Medical Image Processing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Medical Image Processing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 57%" class="percentage">
    57%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 57%" aria-valuenow="57" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/images_ml.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Course Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="medical_imaging.html">2. Medical Imaging Modalities</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="mri.html">3. Working with MRI</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="simpleitk.html">4. Registration and Segmentation with SITK</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        5. Preparing Images for Machine Learning
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#basic-steps">Basic Steps</a></li>
<li><a href="#images-features">Images’ Features</a></li>
<li><a href="#harmonization">Harmonization</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="anonymization.html">6. Anonymizing Medical Images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="generative_ai.html">7. Generative AI in Medical Imaging</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="simpleitk.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="anonymization.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="simpleitk.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Registration and
        </a>
        <a class="chapter-link float-end" href="anonymization.html" rel="next">
          Next: Anonymizing Medical...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Preparing Images for Machine Learning</h1>
        <p>Last updated on 2024-09-14 |

        <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/edit/main/episodes/images_ml.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What are the fundamental steps in preparing images for machine
learning?</li>
<li>What techniques can be used to augment data?</li>
<li>How should data from various sources or collected under different
conditions be handled?</li>
<li>How can we generate features for machine learning using radiomics or
volumetrics?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Outline the fundamental steps involved in preparing images for
machine learning</li>
<li>Demonstrate data augmentation techniques using affine
transformations</li>
<li>Discuss the potential pitfalls of data augmentation</li>
<li>Explain the concept of derived features, including radiomics and
other pipeline-derived features</li>
<li>Review image harmonization techniques at both the image and dataset
levels</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="basic-steps">Basic Steps<a class="anchor" aria-label="anchor" href="#basic-steps"></a></h2>
<hr class="half-width"><p>Datasets of images can serve as the raw data for machine learning
(ML). While in rare cases they might be ready for use with minimal
effort, in most projects, a significant portion of time is dedicated to
cleaning and preparing the data. The quality of the data directly
impacts the quality of the resulting models.</p>
<p>One of the initial steps in building a model involves manually
inspecting both the data and metadata.</p>
<div id="challenge-thinking-about-metadata" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-thinking-about-metadata" class="callout-inner">
<h3 class="callout-title">Challenge: Thinking About Metadata</h3>
<div class="callout-content">
<p>What metadata should you examine in almost any radiological
dataset?</p>
<p>Hint: Consider metadata pertinent to brain and thorax imaging.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>In almost any radiological dataset, it is essential to examine the
age and sex distribution. These metadata are crucial for both brain MRIs
and chest X-rays, as well as for many other types of imaging
studies.</p>
</div>
</div>
</div>
</div>
<p>In real-world scenarios, we often face the challenge of investigating
a specific pathology that is relatively rare. Consequently, our dataset
may contain thousands of normal subjects but relatively few with any
pathology, and even fewer with the pathology of interest. This creates
an imbalanced dataset and can introduce biases. For instance, if we aim
to develop a model to detect heart failure on chest X-rays, but all our
heart failure patients are older men, the model may incorrectly “focus”
(by exploiting statistical correlations) on the absence of female
breasts and signs of aging, rather than on true heart failure indicators
like the cardiothoracic ratio.</p>
<p>Here are some initial steps to understanding your dataset if you plan
to do supervised ML:</p>
<ol style="list-style-type: decimal"><li>Check some images by hand: assess quality, content, and any
unexpected elements.</li>
<li>Check some labeling by hand: ensure accuracy, consistency, and note
any surprises.</li>
<li>Diversity check for obvious protected classes: examine images,
labels, or metadata for representation.</li>
<li>Convert images to a lossless format and store a backup of the data
collection.</li>
<li>Anonymize data: remove identifiable information within images
(consider using OCR for text).</li>
<li>Determine important image features: consider creating cropped
versions.</li>
<li>Normalize images: adjust for size, histogram, and other factors,
ensuring proper centering when necessary.</li>
<li>Re-examine some images by hand: look for artifacts introduced during
preprocessing steps.</li>
<li>Harmonize the dataset.</li>
<li>Create augmented and/or synthetic data.</li>
</ol><p>When preparing images for unsupervised learning, many of these steps
still apply. However, you must also consider the specific algorithm’s
requirements, as some segmentation algorithms may not benefit from
additional data.</p>
<p>In our preparation for ML as outlined above, step two involves
verifying the accuracy of labeling. The label represents the target
variable you want your model to predict, so it is crucial to ensure that
the labeling is both accurate and aligns with the outcomes you expect
your model to predict.</p>
<p>In step three, we emphasize the importance of checking for diversity
among protected classes—groups that are often subject to specific
legislation in medical diagnostics due to historical
underrepresentation. It is essential to ensure your dataset includes
women and ethnic minority groups, as population-level variations can
significantly impact model performance. For instance, chest
circumference and height can vary greatly between populations, such as
between Dutch and Indonesian people. While these differences might not
affect an algorithm focused on cerebral blood flow, they are critical
for others.</p>
<p>In step five, the focus is on anonymization, particularly in imaging
data like ultrasounds, where patient names or diagnoses might appear
directly on the image. Simple cropping may sometimes suffice, but more
advanced techniques such as blurring, masking, or optical character
recognition (OCR) should also be considered to ensure thorough
anonymization.</p>
<p>We will cover step nine, dataset harmonization, in a separate
section. For step ten, creating more data, synthetic data generation
will be discussed further in an episode on generative AI. In the next
section, we will explore examples of augmented data creation.</p>
<p>Let’s go throught some examples. First, we import the libraries we
need:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> matplotlib</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> transform</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="im">from</span> skimage.transform <span class="im">import</span> rotate</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> transform <span class="im">as</span> tf</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="im">from</span> skimage.transform <span class="im">import</span> PiecewiseAffineTransform</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="im">from</span> skimage.transform <span class="im">import</span> resize</span></code></pre>
</div>
<p>Then, we import our example images and examine them.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>image_cxr1 <span class="op">=</span> io.imread(<span class="st">'data/ml/rotatechest.png'</span>) <span class="co"># a relatively normal chest X-ray (CXR)</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>image_cxr_cmegaly <span class="op">=</span> io.imread(<span class="st">'data/ml/cardiomegaly_cc0.png'</span>) <span class="co"># cardiomegaly CXR</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>image_cxr2 <span class="op">=</span> io.imread(<span class="st">'data/ml/other_op.png'</span>) <span class="co"># a relatively normal CXR</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># create figure</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>  </span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co"># setting values to rows and column variables</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>columns <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co"># Adds a subplot at the 1st position</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">1</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>plt.imshow(image_cxr1)</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>plt.title(<span class="st">"Normal 1"</span>)</span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a><span class="co"># add a subplot at the 2nd position</span></span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">2</span>)</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>plt.imshow(image_cxr_cmegaly)</span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>plt.title(<span class="st">"Cardiomegaly"</span>)</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a><span class="co"># add a subplot at the 3nd position</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">3</span>)</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>plt.imshow(image_cxr2)</span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>plt.title(<span class="st">"Normal 2"</span>)</span></code></pre>
</div>
<figure><img src="fig/cxr_display_mip.png" alt="CXR examples" class="figure mx-auto d-block"></figure><div id="challenge-can-you-see-some-problems-in-the-following-scenario" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-can-you-see-some-problems-in-the-following-scenario" class="callout-inner">
<h3 class="callout-title">Challenge: Can You See Some problems in the Following Scenario?</h3>
<div class="callout-content">
<p>Imagine you got the above images and many more because you have been
assigned to make an algorithm for cardiomegaly detection. The goal is to
notify patients if their hospital-acquired X-rays, taken for any reason,
show signs of cardiomegaly. This is an example of using ML for
opportunistic screening.</p>
<p>You are provided with two datasets:</p>
<ul><li>A dataset of healthy (no cardiomegaly) patients from an outpatient
clinic in a very poor area, staffed by first-year radiography students.
These patients were being screened for tuberculosis (TB).</li>
<li>A dataset of chest X-rays of cardiomegaly patients from an extremely
prestigious tertiary inpatient hospital.</li>
</ul></div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>All of the following may pose potential problems:</p>
<ul><li>We may have different quality images from different machines for our
healthy versus diseased patients, which could introduce a “batch effect”
and create bias.</li>
<li>At the prestigious hospital, many X-rays might be taken in the
supine position. Will these combine well with standing AP X-rays?</li>
<li>There could be concerns about the accuracy of labeling at the clinic
since it was performed by lower-level staff.</li>
</ul></div>
</div>
</div>
</div>
<div id="challenge-prepare-the-images-for-classic-supervised-ml" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-prepare-the-images-for-classic-supervised-ml" class="callout-inner">
<h3 class="callout-title">Challenge: Prepare the Images for Classic Supervised ML</h3>
<div class="callout-content">
<p>Use <code>skimage.transform.rotate</code> to create two realistic
augmented images from the given ‘normal’ image stored in the
variables.</p>
<p>Then, in a single block of code, apply what you perceive as the most
critical preprocessing operations to prepare these images for classic
supervised ML.</p>
<p>Hint: Carefully examine the shape of the cardiomegaly image. Consider
the impact of harsh lines on ML performance.</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># figure out how much to cut on sides</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"cut top/bottom:"</span>, (image_cxr_cmegaly.shape[<span class="dv">0</span>] <span class="op">-</span> image_cxr1.shape[<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>cut_top_bottom <span class="op">=</span> <span class="bu">abs</span>(<span class="bu">round</span>((image_cxr_cmegaly.shape[<span class="dv">0</span>] <span class="op">-</span> image_cxr1.shape[<span class="dv">0</span>])<span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># figure our how much to cut on top and bottom</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"cut sides:"</span>,(image_cxr_cmegaly.shape[<span class="dv">1</span>] <span class="op">-</span> image_cxr1.shape[<span class="dv">1</span>])<span class="op">/</span><span class="dv">2</span>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>cut top/bottom: -119.0
cut sides: -208.5</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>cut_sides <span class="op">=</span> <span class="bu">abs</span>(<span class="bu">round</span>((image_cxr_cmegaly.shape[<span class="dv">1</span>] <span class="op">-</span> image_cxr1.shape[<span class="dv">1</span>])<span class="op">/</span><span class="dv">2</span>))</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>list_images <span class="op">=</span> [image_cxr1, image_cxr_cmegaly, image_cxr2]</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>better_for_ml_list <span class="op">=</span> []</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> list_images:</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>    image <span class="op">=</span> rotate(image,<span class="dv">2</span>)</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>    image <span class="op">=</span> image[cut_top_bottom:<span class="op">-</span>cut_top_bottom, cut_sides: <span class="op">-</span>cut_sides]</span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>    better_for_ml_list.append(image)</span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a><span class="co"># create figure for display</span></span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  </span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a><span class="co"># setting values to rows and column variables</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>columns <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a></span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a><span class="co"># add a subplot at the 1st position</span></span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">1</span>)</span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a>plt.imshow(better_for_ml_list[<span class="dv">0</span>])</span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>plt.title(<span class="st">"Normal example rotated"</span>)</span>
<span id="cb5-22"><a href="#cb5-22" tabindex="-1"></a>  </span>
<span id="cb5-23"><a href="#cb5-23" tabindex="-1"></a><span class="co"># add a subplot at the 2nd position</span></span>
<span id="cb5-24"><a href="#cb5-24" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">2</span>)</span>
<span id="cb5-25"><a href="#cb5-25" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb5-26"><a href="#cb5-26" tabindex="-1"></a>plt.imshow(better_for_ml_list[<span class="dv">1</span>])</span>
<span id="cb5-27"><a href="#cb5-27" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb5-28"><a href="#cb5-28" tabindex="-1"></a>plt.title(<span class="st">"Cardiomegaly rotated"</span>)</span>
<span id="cb5-29"><a href="#cb5-29" tabindex="-1"></a></span>
<span id="cb5-30"><a href="#cb5-30" tabindex="-1"></a><span class="co"># add a subplot at the 3nd position</span></span>
<span id="cb5-31"><a href="#cb5-31" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">3</span>)</span>
<span id="cb5-32"><a href="#cb5-32" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb5-33"><a href="#cb5-33" tabindex="-1"></a>plt.imshow(better_for_ml_list[<span class="dv">2</span>])</span>
<span id="cb5-34"><a href="#cb5-34" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb5-35"><a href="#cb5-35" tabindex="-1"></a>plt.title(<span class="st">"Another normal rotated"</span>)</span>
<span id="cb5-36"><a href="#cb5-36" tabindex="-1"></a></span></code></pre>
</div>
<figure><img src="fig/augmented_cxr_rotate_interem.png" alt="augmented chest x-ray different sizes" class="figure mx-auto d-block"></figure><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># find a size we want to resize to, here the smallest</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>zero_side <span class="op">=</span> []</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>one_side <span class="op">=</span> []</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> better_for_ml_list:</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>    zero_side.append(image.shape[<span class="dv">0</span>])</span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>    zero_side.sort()</span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>    one_side.append(image.shape[<span class="dv">1</span>])</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a>    one_side.sort()</span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a>smallest_size <span class="op">=</span> zero_side[<span class="dv">0</span>], one_side[<span class="dv">0</span>]</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># make resized images</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a>resized <span class="op">=</span> []</span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="cf">for</span> image <span class="kw">in</span> better_for_ml_list:</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>    image <span class="op">=</span>  resize(image, (smallest_size))</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>    resized.append(image)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a></span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co"># create figure for display</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  </span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a><span class="co"># setting values to rows and column variables</span></span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a>columns <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a></span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a><span class="co"># add a subplot at the 1st position</span></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">1</span>)</span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a>plt.imshow(resized[<span class="dv">0</span>])</span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>plt.title(<span class="st">"Normal 1 Augmented Resized"</span>)</span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>  </span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a><span class="co"># add a subplot at the 2nd position</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">2</span>)</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>plt.imshow(resized[<span class="dv">1</span>])</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>plt.title(<span class="st">"Augment Cardiomegaly Resized"</span>)</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co"># add a subplot at the 3nd position</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">3</span>)</span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>plt.imshow(resized[<span class="dv">2</span>])</span>
<span id="cb6-41"><a href="#cb6-41" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb6-42"><a href="#cb6-42" tabindex="-1"></a>plt.title(<span class="st">"Normal 2 Augment  Resized"</span>)</span></code></pre>
</div>
<figure><img src="fig/augmented_cxr_rotate.png" alt="augmented chest x-ray" class="figure mx-auto d-block"></figure><p>There are a few key considerations to keep in mind regarding the
choices made here. The goal is to create data that realistically
represents what might occur in real-life scenarios. For example, a
2-degree rotation is far more realistic than a 25-degree rotation.
Unless you are using a rotationally invariant algorithm or another
advanced method that accounts for such differences, even small rotations
can make every pixel slightly different for the computer. A 2-degree
rotation closely mirrors what might happen in a clinical setting, making
it a more practical choice.</p>
<p>Additionally, the results can be further improved by cropping the
images. Generally, we aim to minimize harsh, artificial lines in any
images used for ML algorithms, unless those lines are consistent across
all images. It is a common observation among practitioners that many ML
algorithms tend to “focus” on these harsh lines, so if they are not
uniformly present, it is better to remove them. As for how much to crop,
we based our decision on the size of our images. While you don’t need to
follow our exact approach, it is important to ensure that all images are
ultimately the same size and that all critical features are
retained.</p>
</div>
</div>
</div>
</div>
<p>Of course, there are numerous other transformations we can apply to
images beyond rotation. For example, let’s explore applying a shear:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># create affine transform</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>affine_tf <span class="op">=</span> tf.AffineTransform(shear<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># apply transform to image data</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>image_affine_tf <span class="op">=</span> tf.warp(image_cxr_cmegaly, inverse_map<span class="op">=</span>affine_tf)</span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co"># display the result</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>io.imshow(image_affine_tf)</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>io.show()</span></code></pre>
</div>
<figure><img src="fig/shear_cxr.png" alt="augmented by shear chest x-ray" class="figure mx-auto d-block"></figure><p>And finally, let’s demonstrate a “wave over a mesh.” We’ll start by
creating a grid, or “mesh,” over our image, represented by dots in our
plot. Then, we’ll apply a warp function to transform the image into the
shape of a wave.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>rows, cols <span class="op">=</span> image_affine_tf.shape[<span class="dv">0</span>], image_affine_tf.shape[<span class="dv">1</span>]</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co"># np.linspace will return evenly spaced numbers over an interval</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a>src_cols <span class="op">=</span> np.linspace(<span class="dv">0</span>, cols, <span class="dv">20</span>)</span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co"># ie above is start=0, stop = cols, num = 50, and num is the number of chops</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>src_rows <span class="op">=</span> np.linspace(<span class="dv">0</span>, rows, <span class="dv">10</span>)</span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co"># np.meshgrid returns coordinate matrices from coordinate vectors.</span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>src_rows, src_cols <span class="op">=</span> np.meshgrid(src_rows, src_cols)</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co"># numpy dstack stacks along a third dimension in the concatenation</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>src <span class="op">=</span> np.dstack([src_cols.flat, src_rows.flat])[<span class="dv">0</span>]</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>dst_rows <span class="op">=</span> src[:, <span class="dv">1</span>] <span class="op">-</span> np.sin(np.linspace(<span class="dv">0</span>, <span class="dv">3</span> <span class="op">*</span> np.pi, src.shape[<span class="dv">0</span>])) <span class="op">*</span> <span class="dv">50</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>dst_cols <span class="op">=</span> src[:, <span class="dv">0</span>]</span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>dst_rows <span class="op">*=</span> <span class="fl">1.5</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a>dst_rows <span class="op">-=</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="dv">50</span></span>
<span id="cb8-17"><a href="#cb8-17" tabindex="-1"></a>dst <span class="op">=</span> np.vstack([dst_cols, dst_rows]).T</span>
<span id="cb8-18"><a href="#cb8-18" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" tabindex="-1"></a>tform <span class="op">=</span> PiecewiseAffineTransform()</span>
<span id="cb8-20"><a href="#cb8-20" tabindex="-1"></a>tform.estimate(src, dst)</span>
<span id="cb8-21"><a href="#cb8-21" tabindex="-1"></a>noform <span class="op">=</span> PiecewiseAffineTransform()</span>
<span id="cb8-22"><a href="#cb8-22" tabindex="-1"></a>noform.estimate(src, src)</span>
<span id="cb8-23"><a href="#cb8-23" tabindex="-1"></a></span>
<span id="cb8-24"><a href="#cb8-24" tabindex="-1"></a>out_rows <span class="op">=</span> image_affine_tf.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="dv">50</span></span>
<span id="cb8-25"><a href="#cb8-25" tabindex="-1"></a>out_cols <span class="op">=</span> cols</span>
<span id="cb8-26"><a href="#cb8-26" tabindex="-1"></a>out <span class="op">=</span> tf.warp(image_affine_tf, tform, output_shape<span class="op">=</span>(out_rows, out_cols))</span>
<span id="cb8-27"><a href="#cb8-27" tabindex="-1"></a><span class="co"># create figure</span></span>
<span id="cb8-28"><a href="#cb8-28" tabindex="-1"></a>fig <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">7</span>))</span>
<span id="cb8-29"><a href="#cb8-29" tabindex="-1"></a>  </span>
<span id="cb8-30"><a href="#cb8-30" tabindex="-1"></a><span class="co"># setting values to rows and column variables</span></span>
<span id="cb8-31"><a href="#cb8-31" tabindex="-1"></a>rows <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-32"><a href="#cb8-32" tabindex="-1"></a>columns <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb8-33"><a href="#cb8-33" tabindex="-1"></a></span>
<span id="cb8-34"><a href="#cb8-34" tabindex="-1"></a><span class="co"># add a subplot at the 1st position</span></span>
<span id="cb8-35"><a href="#cb8-35" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">1</span>)</span>
<span id="cb8-36"><a href="#cb8-36" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb8-37"><a href="#cb8-37" tabindex="-1"></a>plt.imshow(image_affine_tf)</span>
<span id="cb8-38"><a href="#cb8-38" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb8-39"><a href="#cb8-39" tabindex="-1"></a>plt.title(<span class="st">"Normal"</span>)</span>
<span id="cb8-40"><a href="#cb8-40" tabindex="-1"></a>  </span>
<span id="cb8-41"><a href="#cb8-41" tabindex="-1"></a><span class="co"># add a subplot at the 2nd position</span></span>
<span id="cb8-42"><a href="#cb8-42" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">2</span>)</span>
<span id="cb8-43"><a href="#cb8-43" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb8-44"><a href="#cb8-44" tabindex="-1"></a>plt.imshow(image_affine_tf)</span>
<span id="cb8-45"><a href="#cb8-45" tabindex="-1"></a>plt.plot(noform.inverse(src)[:, <span class="dv">0</span>], noform.inverse(src)[:, <span class="dv">1</span>], <span class="st">'.b'</span>)</span>
<span id="cb8-46"><a href="#cb8-46" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb8-47"><a href="#cb8-47" tabindex="-1"></a>plt.title(<span class="st">"Normal and Mesh"</span>)</span>
<span id="cb8-48"><a href="#cb8-48" tabindex="-1"></a></span>
<span id="cb8-49"><a href="#cb8-49" tabindex="-1"></a><span class="co"># add a subplot at the 3nd position</span></span>
<span id="cb8-50"><a href="#cb8-50" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">3</span>)</span>
<span id="cb8-51"><a href="#cb8-51" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb8-52"><a href="#cb8-52" tabindex="-1"></a>plt.imshow(out)</span>
<span id="cb8-53"><a href="#cb8-53" tabindex="-1"></a></span>
<span id="cb8-54"><a href="#cb8-54" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb8-55"><a href="#cb8-55" tabindex="-1"></a>plt.title(<span class="st">"Augment"</span>)</span>
<span id="cb8-56"><a href="#cb8-56" tabindex="-1"></a></span>
<span id="cb8-57"><a href="#cb8-57" tabindex="-1"></a><span class="co"># add a subplot at the 3nd position</span></span>
<span id="cb8-58"><a href="#cb8-58" tabindex="-1"></a>fig.add_subplot(rows, columns, <span class="dv">4</span>)</span>
<span id="cb8-59"><a href="#cb8-59" tabindex="-1"></a><span class="co"># showing image</span></span>
<span id="cb8-60"><a href="#cb8-60" tabindex="-1"></a>plt.imshow(out)</span>
<span id="cb8-61"><a href="#cb8-61" tabindex="-1"></a>plt.plot(tform.inverse(src)[:, <span class="dv">0</span>], tform.inverse(src)[:, <span class="dv">1</span>], <span class="st">'.b'</span>)</span>
<span id="cb8-62"><a href="#cb8-62" tabindex="-1"></a>plt.axis(<span class="st">'off'</span>)</span>
<span id="cb8-63"><a href="#cb8-63" tabindex="-1"></a>plt.title(<span class="st">"Augment and Mesh"</span>)</span></code></pre>
</div>
<figure><img src="fig/augment_and_mesh.png" alt="augmented by waves chest x-ray" class="figure mx-auto d-block"></figure><p>The last transformation doesn’t appear realistic. The chest became
noticeably widened, which could be problematic. When augmenting data,
there are numerous possibilities, but it’s crucial to ensure the
augmented data remains realistic. Only a subject matter expert
(typically a pathologist, nuclear medicine specialist, or radiologist)
can accurately determine what realistic data should look like.</p>
<div id="libraries-for-medical-image-augmentation" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="libraries-for-medical-image-augmentation" class="callout-inner">
<h3 class="callout-title">Libraries for Medical Image Augmentation</h3>
<div class="callout-content">
<p>We demonstrated how to augment medical images using scikit-image.
Another great resource for augmentation is SimpleITK, which offers a
dedicated <a href="https://insightsoftwareconsortium.github.io/SimpleITK-Notebooks/Python_html/70_Data_Augmentation.html" class="external-link">tutorial
on data augmentation</a>. Additionally, OpenCV provides versatile tools
for image processing and augmentations.</p>
<p>To keep your environment manageable, we recommend using just one of
these libraries. scikit-image, SimpleITK, and OpenCV all offer effective
solutions for medical image augmentation.</p>
</div>
</div>
</div>
</section><section><h2 class="section-heading" id="images-features">Images’ Features<a class="anchor" aria-label="anchor" href="#images-features"></a></h2>
<hr class="half-width"><p>So far, we’ve focused on examples where we directly manipulate
images. However, much of ML involves working with derived values from
images, often converted into tabular data. In fact, it’s possible to
combine images with various types of tabular data in multiple ways for
ML. But before exploring these methods, let’s first consider using image
features alone as inputs for ML.</p>
<p>Two notable examples of image features are volumetric data and
radiomic data. Handling such data at scale—when dealing with thousands
of images—typically involves automated processes rather than manual
measurements. In the past, pioneers like Benjamin Felson, a founding
figure in modern chest X-ray analysis, painstakingly analyzed hundreds
of X-rays by hand to gather statistics. Today, processing pipelines
allow us to efficiently analyze thousands of images simultaneously.</p>
<p>We aim to integrate images into a pipeline that automatically
generates various types of data. A notable example of such a feature
pipeline, particularly for brain imaging, is <a href="https://surfer.nmr.mgh.harvard.edu/" class="external-link">Freesurfer</a>. Freesurfer
facilitates the extraction of volume and other relevant data from brain
imaging scans.</p>
<div id="challenge-identifying-issues-with-pipeline-outputs-in-the-absence-of-original-images" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-identifying-issues-with-pipeline-outputs-in-the-absence-of-original-images" class="callout-inner">
<h3 class="callout-title">Challenge: Identifying Issues with Pipeline Outputs in the Absence of Original Images</h3>
<div class="callout-content">
<p>Consider potential issues that could arise from using the output of a
pipeline without accessing the original images.</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>One major concern is accuracy, as pipelines may mislabel or miscount
features, potentially leading to unreliable data analysis or model
training. To mitigate these issues, consider:</p>
<ul><li>Manual verification: validate pipeline outputs by manually reviewing
a subset of images to ensure consistency with expected results.</li>
<li>Literature review: consult existing research to establish benchmarks
for feature counts and volumes, helping identify discrepancies that may
indicate pipeline errors.</li>
<li>Expert consultation: seek insights from radiologists or domain
experts to assess the credibility of pipeline outputs based on their
clinical experience.</li>
</ul><p>Proceed with caution when relying on pipeline outputs, especially
without direct access to the original images.</p>
<p>Another challenge with pipelines is that the results can vary
significantly depending on which one is chosen. For a detailed
exploration of how this can impact fMRI data, see this <a href="https://doi.org/10.1038/s41467-024-48781-5" class="external-link">Nature article</a>.
Without access to the original images, it becomes difficult to determine
which pipeline most accurately captures the desired outcomes from the
data.</p>
</div>
</div>
</div>
</div>
<p>Morphometric or volumetric data represents one type of derived data,
but radiomics introduces another dimension. Radiomics involves analyzing
mathematical characteristics within images, such as entropy or kurtosis.
Similar methodologies applied to pathology are referred to as pathomics.
Some define radiomics and pathomics as advanced texture analysis in
medical imaging, while others argue they encompass a broader range of
quantitative data than traditional texture analysis methods.</p>
<p>Regardless of the data type chosen, the typical approach involves
segmenting and/or masking an image to isolate the area of interest,
followed by applying algorithms to derive radiomic or pathomic features.
While it’s possible to develop custom code for this purpose, using
established packages is preferred for ensuring reproducibility. For
future reproducibility, adherence to standards such as those set by the
International Bio-imaging Standards Initiative (<a href="https://theibsi.github.io/" class="external-link">IBSI</a>) is crucial.</p>
<p>Below is a list of open-source* libraries that facilitate this type
of analysis:</p>
<table class="table"><colgroup><col width="10%"><col width="14%"><col width="30%"><col width="22%"><col width="22%"></colgroup><thead><tr class="header"><th></th>
<th><code>mirp</code></th>
<th><code>pyradiomics</code></th>
<th><code>LIFEx</code></th>
<th><code>radiomics</code></th>
</tr></thead><tbody><tr class="odd"><td>License</td>
<td>EUPL-1.2</td>
<td>BSD-3</td>
<td>custom</td>
<td>GPL-3.0</td>
</tr><tr class="even"><td>Last updated</td>
<td>5/2024</td>
<td>1/2024</td>
<td>6/2023</td>
<td>11/2019</td>
</tr><tr class="odd"><td>Programming language</td>
<td>Python</td>
<td>Python</td>
<td>Java</td>
<td>MATLAB</td>
</tr><tr class="even"><td>IBSI-1 compliant</td>
<td>yes</td>
<td>partial</td>
<td>yes</td>
<td>no claim</td>
</tr><tr class="odd"><td>IBSI-2 compliant</td>
<td>yes</td>
<td>no claim</td>
<td>yes</td>
<td>no claim</td>
</tr><tr class="even"><td>Interface</td>
<td>high-level API</td>
<td>high-level API, Docker</td>
<td>GUI, low-level API</td>
<td>low-level API</td>
</tr><tr class="odd"><td>Website</td>
<td><a href="https://github.com/oncoray/mirp" class="external-link">GitHub</a></td>
<td><a href="https://github.com/AIM-Harvard/pyradiomics" class="external-link">GitHub</a></td>
<td><a href="https://www.lifexsoft.org/" class="external-link">website</a></td>
<td><a href="https://github.com/mvallieres/radiomics" class="external-link">GitHub</a></td>
</tr><tr class="even"><td>Early publication</td>
<td><a href="https://joss.theoj.org/papers/10.21105/joss.06413" class="external-link">JOSS
publication</a></td>
<td><a href="https://doi.org/10.1158/0008-5472.CAN-17-0339" class="external-link">doi:10.1158/0008-5472.CAN-17-0339</a></td>
<td><a href="https://doi.org/10.1038/s41598-022-16609-1" class="external-link">doi:10.1158/0008-5472.CAN-18-0125</a></td>
<td><a href="https://doi.org/10.1088/0031-9155/60/14/5471" class="external-link">doi:10.1088/0031-9155/60/14/5471</a></td>
</tr><tr class="odd"><td>Notes</td>
<td>relative newcomer</td>
<td>very standard and supported</td>
<td>user-friendly</td>
<td>* MATLAB requires a license</td>
</tr></tbody></table><p>Once we have tabular data, we can apply various algorithms to analyze
it. However, applying ML isn’t just a matter of running algorithms and
getting quick results. In the next section, we will explore one reason
why this process is more complex than it may seem.</p>
</section><section><h2 class="section-heading" id="harmonization">Harmonization<a class="anchor" aria-label="anchor" href="#harmonization"></a></h2>
<hr class="half-width"><p>We often need to harmonize either images or datasets of derived
features. When dealing with images, differences between datasets can be
visually apparent. For example, if one set of X-rays consistently
appears darker, it may be wise to compare average pixel values between
datasets and adjust normalization to achieve more uniformity. This is a
straightforward scenario.</p>
<p>Consider another example involving derived datasets from brain MRIs
with Virchow Robin’s spaces. One dataset was captured using a 1.5 Tesla
machine in a distant location, while the other used an experimental 5
Tesla machine (high resolution) in an advanced hospital. These machines
vary in resolution, meaning what appears as a single Virchow Robin’s
space at low resolution might actually show as two or three smaller
spaces fused together at high resolution. This is just one potential
difference.</p>
<p>Below are images of the same patient scanned with 1.5 Tesla and 3
Tesla machines:</p>
<figure><img src="fig/t1_vT3_large.jpg" alt="T1 v T3" class="figure mx-auto d-block"></figure><p><em>Sourced from <a href="https://www.ajnr.org/content/26/9/2229" class="external-link">Bernd L. Schmitz, Andrik
J. Aschoff, Martin H.K. Hoffmann and Georg Grön, Advantages and Pitfalls
in 3T MR Brain Imaging: A Pictorial Review, American Journal of
Neuroradiology October 2005, 26 (9) 2229-2237</a></em></p>
<p>Different contrast levels significantly affect the visibility of
structures like the caudate and thalami in brain images. As a result,
the radiomic characteristics of these images, including contrast and
possibly other parameters, can vary even when they originate from the
same patient.</p>
<p>Constructing a dataset based solely on extensive, unharmonized
derived data is not always practical. However, without access to the
original images, it becomes difficult to fully understand and account
for these variations.</p>
<p>We recommend the following approach:</p>
<ol style="list-style-type: decimal"><li>Compare the data using descriptive statistics and your knowledge of
the patient groups. Consider whether you expect similar counts across
both groups, and justify your reasoning.</li>
<li>Explore the use of a harmonization package to standardize data
across different datasets.</li>
</ol><p>Below are three examples from the field of neuroimaging:</p>
<table class="table"><colgroup><col width="18%"><col width="25%"><col width="22%"><col width="33%"></colgroup><thead><tr class="header"><th></th>
<th><code>neurocombat</code></th>
<th><code>haca3</code></th>
<th><code>autocombat</code></th>
</tr></thead><tbody><tr class="odd"><td>License</td>
<td>MIT for Python/ Artistic for R</td>
<td>Missing?</td>
<td>Apache 2.0</td>
</tr><tr class="even"><td>Last updated</td>
<td>2021</td>
<td>2024</td>
<td>2022</td>
</tr><tr class="odd"><td>Programming language</td>
<td>Python or R</td>
<td>Python</td>
<td>Python</td>
</tr><tr class="even"><td>Organ/area and modality</td>
<td>brain MRI</td>
<td>brain MRI</td>
<td>brain MRI</td>
</tr><tr class="odd"><td>Data type</td>
<td>derived values</td>
<td>images</td>
<td>derived values</td>
</tr><tr class="even"><td>Notes</td>
<td>no standard release yet</td>
<td>versioned but not released</td>
<td>not release, not versioned</td>
</tr><tr class="odd"><td>Original website</td>
<td><a href="https://github.com/Jfortin1/ComBatHarmonization" class="external-link">GitHub</a></td>
<td><a href="https://github.com/lianruizuo/haca3" class="external-link">GitHub</a></td>
<td><a href="https://github.com/Alxaline/ComScan" class="external-link">GitHub</a></td>
</tr><tr class="even"><td>Early publication</td>
<td><a href="https://doi.org/10.1016/j.neuroimage.2017.08.047" class="external-link">doi:
10.1016/j.neuroimage.2017.08.047</a></td>
<td><a href="https://doi.org/10.1016/j.compmedimag.2023.102285" class="external-link">doi:10.1016/j.compmedimag.2023.102285</a></td>
<td><a href="https://doi.org/10.1038/s41598-022-16609-1" class="external-link">doi:
10.1038/s41598-022-16609-1</a></td>
</tr><tr class="odd"><td>Versioned website</td>
<td><a href="https://github.com/brainspinner/cvasl/tree/main/cvasl/vendor/neurocombat" class="external-link">versioned
on cvasl</a></td>
<td><a href="https://github.com/lianruizuo/haca3" class="external-link">versioned on
GitHub</a></td>
<td><a href="https://github.com/brainspinner/cvasl/tree/main/cvasl/vendor/comscan" class="external-link">versioned
on cvasl</a></td>
</tr></tbody></table><p>There are numerous packages available for brain MRI alone, not to
mention those for imaging the rest of the body. We have selected these
three examples to highlight some of the common issues and pitfalls
associated with such packages.</p>
<div id="challenge-identifying-potential-problems-in-each-package" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-identifying-potential-problems-in-each-package" class="callout-inner">
<h3 class="callout-title">Challenge: Identifying Potential Problems in Each Package</h3>
<div class="callout-content">
<p>Consider issues that might hinder your implementation with each
package.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<p>Aging code: <code>neurocombat</code> was last modified three years
ago. It may rely on outdated dependencies that could pose compatibility
issues with newer hardware and software environments. Additionally, the
lack of versioned releases makes it challenging to track changes and
updates.</p>
<p>No license: <code>haca3</code> does not have a clear license
available. Using code without a proper license could lead to legal
complications and uncertainties about its usage rights.</p>
<p>No releases and versioning: <code>autocombat</code> lacks both
released versions and versioning practices. Without clear versioning, it
becomes difficult to ensure consistency and compare results across
different implementations of the package.</p>
</div>
</div>
</div>
</div>
<p>We’ve pointed out a few potential issues to highlight common
challenges with such programs. Looking ahead, consider developing a
harmonization package that’s sustainable and useful for your research
community.</p>
<p>While each of these packages has its strengths for researchers, none
are perfect. Choose wisely when selecting a package! Also, remember you
can create your own harmonization method through coding or develop it
into a package for others to use.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Direct knowledge of specific data cannot be substituted</li>
<li>Statistical analysis is essential to detect and mitigate biases in
patient distribution</li>
<li>Verify if derived data aligns with known clinical realities through
statistical examination</li>
<li>Evaluate the validity and utility of data augmentation methods
before applying them</li>
<li>Radiomics enables the use of mathematical image qualities as
features</li>
<li>There are several accessible pipelines for volumetrics and
radiomics</li>
<li>Data from different machines (or even the same machines with
different settings) often requires harmonization, achievable through
coding and the use of existing libraries</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="simpleitk.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="anonymization.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="simpleitk.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Registration and
        </a>
        <a class="chapter-link float-end" href="anonymization.html" rel="next">
          Next: Anonymizing Medical...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/edit/main/episodes/images_ml.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:c.moore@esciencecenter.nl">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.8" class="external-link">sandpaper (0.16.8)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.6" class="external-link">pegboard (0.7.6)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.4" class="external-link">varnish (1.0.4)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/medical-image-processing/images_ml.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "python, software, lesson, medical images, DICOMs",
  "name": "Preparing Images for Machine Learning",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/medical-image-processing/images_ml.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/medical-image-processing/images_ml.html",
  "dateCreated": "2024-10-14",
  "dateModified": "2024-09-14",
  "datePublished": "2024-10-15"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

