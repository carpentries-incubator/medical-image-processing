<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en" data-bs-theme="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Medical Image Processing: Anonymizing Medical Images</title><meta name="viewport" content="width=device-width, initial-scale=1"><script src="assets/themetoggle.js"></script><link rel="stylesheet" type="text/css" href="assets/styles.css"><script src="assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="favicons/incubator/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="favicons/incubator/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="favicons/incubator/favicon-16x16.png"><link rel="manifest" href="favicons/incubator/site.webmanifest"><link rel="mask-icon" href="favicons/incubator/safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" media="(prefers-color-scheme: light)" content="white"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="black"></head><body>
    <header id="top" class="navbar navbar-expand-md top-nav incubator"><svg xmlns="http://www.w3.org/2000/svg" class="d-none"><symbol id="check2" viewbox="0 0 16 16"><path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z"></path></symbol><symbol id="circle-half" viewbox="0 0 16 16"><path d="M8 15A7 7 0 1 0 8 1v14zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16z"></path></symbol><symbol id="moon-stars-fill" viewbox="0 0 16 16"><path d="M6 .278a.768.768 0 0 1 .08.858 7.208 7.208 0 0 0-.878 3.46c0 4.021 3.278 7.277 7.318 7.277.527 0 1.04-.055 1.533-.16a.787.787 0 0 1 .81.316.733.733 0 0 1-.031.893A8.349 8.349 0 0 1 8.344 16C3.734 16 0 12.286 0 7.71 0 4.266 2.114 1.312 5.124.06A.752.752 0 0 1 6 .278z"></path><path d="M10.794 3.148a.217.217 0 0 1 .412 0l.387 1.162c.173.518.579.924 1.097 1.097l1.162.387a.217.217 0 0 1 0 .412l-1.162.387a1.734 1.734 0 0 0-1.097 1.097l-.387 1.162a.217.217 0 0 1-.412 0l-.387-1.162A1.734 1.734 0 0 0 9.31 6.593l-1.162-.387a.217.217 0 0 1 0-.412l1.162-.387a1.734 1.734 0 0 0 1.097-1.097l.387-1.162zM13.863.099a.145.145 0 0 1 .274 0l.258.774c.115.346.386.617.732.732l.774.258a.145.145 0 0 1 0 .274l-.774.258a1.156 1.156 0 0 0-.732.732l-.258.774a.145.145 0 0 1-.274 0l-.258-.774a1.156 1.156 0 0 0-.732-.732l-.774-.258a.145.145 0 0 1 0-.274l.774-.258c.346-.115.617-.386.732-.732L13.863.1z"></path></symbol><symbol id="sun-fill" viewbox="0 0 16 16"><path d="M8 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0zm0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13zm8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5zM3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8zm10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0zm-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0zm9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707zM4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708z"></path></symbol></svg><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-8">
      <div class="large-logo">
        <img id="incubator-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo.svg"><span class="badge text-bg-warning">
          <abbr title="This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.">
            <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#field-testing-alpha-stage" class="external-link alert-link">
              <i aria-hidden="true" class="icon" data-feather="alert-triangle" style="border-radius: 5px"></i>
              Alpha
            </a>
            <span class="visually-hidden">This lesson is in the alpha phase, which means that it has been taught once and lesson authors are iterating on feedback.</span>
          </abbr>
        </span>

      </div>
    </div>
    <div class="selector-container">
      <div id="theme-selector">
        <li class="nav-item dropdown" id="theme-button-list">
          <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
            <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="bd-theme-text"><li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                Light
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                Dark
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
            <li>
              <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                Auto
                <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
            </li>
          </ul></li>
      </div>

      <div class="dropdown" id="instructor-dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Learner View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='instructor/anonymization.html';">Instructor View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Medical Image Processing
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="Search the All In One page" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Medical Image Processing
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="reference.html#glossary">Glossary</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="profiles.html">Learner Profiles</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><li><a class="dropdown-item" href="reference.html">Glossary</a></li>
          </ul></li>
      </ul></div>
    <!--
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
      <input class="form-control me-2 searchbox" type="search" placeholder="" aria-label="">
        <button class="btn btn-outline-success tablet-search-button"  type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="Search the All In One page"></i>
        </button>
      </fieldset>
    </form>
    -->
    <a id="search-button" class="btn btn-primary" href="aio.html" role="button" aria-label="Search the All In One page">Search the All In One page</a>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Medical Image Processing
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 83%" class="percentage">
    83%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 83%" aria-valuenow="83" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row" id="theme-row-mobile">
            <div class="col" id="theme-selector">
              <li class="nav-item dropdown" id="theme-button-list">
                <button class="btn btn-link nav-link px-0 px-lg-2 dropdown-toggle d-flex align-items-center" id="bd-theme" type="button" aria-expanded="false" data-bs-toggle="dropdown" data-bs-display="static" aria-label="Toggle theme (auto)">
                  <svg class="bi my-1 theme-icon-active"><use href="#circle-half"></use></svg><span class="d-lg-none ms-1" id="bd-theme-text">Toggle Theme</span>
                </button>
                <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="bd-theme-text"><li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="light" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#sun-fill"></use></svg>
                      Light
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center" data-bs-theme-value="dark" aria-pressed="false">
                      <svg class="bi me-2 theme-icon"><use href="#moon-stars-fill"></use></svg>
                      Dark
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                  <li>
                    <button type="button" class="btn dropdown-item d-flex align-items-center active" data-bs-theme-value="auto" aria-pressed="true">
                      <svg class="bi me-2 theme-icon"><use href="#circle-half"></use></svg>
                      Auto
                      <svg class="bi ms-auto d-none"><use href="#check2"></use></svg></button>
                  </li>
                </ul></li>
            </div>
          </div>
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Learner View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="instructor/anonymization.html">Instructor View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->

            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Setup</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="introduction.html">1. Course Introduction</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="medical_imaging.html">2. Medical Imaging Modalities</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="mri.html">3. Working with MRI</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="simpleitk.html">4. Registration and Segmentation with SITK</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="images_ml.html">5. Preparing Images for Machine Learning</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="pathology.html">6. Working with Pathology Images</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        7. Anonymizing Medical Images
        </span>
      </button>
    </div><!--/div.accordion-header-->

    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#types-of-patient-identifying-data">Types of Patient Identifying Data</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush9">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading9">
        <a href="generative_ai.html">8. Generative AI in Medical Imaging</a>
    </div><!--/div.accordion-header-->

  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush lesson-resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="lesson-resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="reference.html#glossary">Glossary</a>
                      </li>
                      <li>
                        <a href="profiles.html">Learner Profiles</a>
                      </li>
                      <li><a href="reference.html">Glossary</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width lesson-resources"><a href="aio.html">See all in one page</a>


            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">

            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="pathology.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="generative_ai.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="pathology.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Working with
        </a>
        <a class="chapter-link float-end" href="generative_ai.html" rel="next">
          Next: Generative AI in...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Anonymizing Medical Images</h1>
        <p>Last updated on 2025-03-18 |

        <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/edit/main/episodes/anonymization.md" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>



        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>What types of data make patient’s imaging data identifiable?</li>
<li>How can I ensure the safe sharing of medical image data?</li>
<li>How can I remove specific metadata from DICOM files?</li>
<li>How can I deal with identifying data within images themselves?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Provide examples of data that makes patient images identifiable</li>
<li>Discuss the concepts of identifiable data and anonymization</li>
<li>Demonstrate how approaches to anonymizing identifiable images</li>
<li>Demonstrate the use of the Pydicom library to manage DICOM
metadata</li>
</ul></div>
</div>
</div>
</div>
</div>
<section><h2 class="section-heading" id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a></h2>
<hr class="half-width"><p>Each of us is similar yet unique, and this individuality can make us
identifiable, posing challenges for medical research. While open data
sharing advances research, most patients would not want their medical
details shared if they could be identified. In most countries, patient
information is protected by law.</p>
<p>Metadata elements in imaging, such as patient names and addresses,
are often clearly designed to identify patients. However, the uniqueness
of patients means that even images without obvious metadata, such as
names, can potentially be identified as belonging to a specific
individual. With advancements in facial recognition software and search
engines, images we previously thought were non-identifiable, like head
CTs, MRIs, <a href="https://doi.org/10.1016/j.neuroimage.2022.119357" class="external-link">or
even PET scans</a>, can theoretically be traced back to a specific
patient. To address this, we can implement de-identification strategies
to create shareable data.</p>
</section><section><h2 class="section-heading" id="types-of-patient-identifying-data">Types of Patient Identifying Data<a class="anchor" aria-label="anchor" href="#types-of-patient-identifying-data"></a></h2>
<hr class="half-width"><div class="section level3">
<h3 id="metadata">Metadata<a class="anchor" aria-label="anchor" href="#metadata"></a></h3>
<p>DICOM files contain metadata, which includes various types of
identifying information that should remain confidential. The easiest way
to mitigate issues with DICOM metadata is to avoid having it in the
first place. If possible, opt to receive just the images and select
metadata rather than the entire DICOM file. When sharing data with
collaborators, there is often no need to share the full DICOM files.</p>
</div>
<div class="section level3">
<h3 id="text-on-images">Text on Images<a class="anchor" aria-label="anchor" href="#text-on-images"></a></h3>
<p>Occasionally, technicians will “burn” information directly onto
images. This means they change the image itself with text that becomes
part of the image pixels. This “burned-in” annotation may include
details such as diagnoses, demographics, or the patient’s name.
Fortunately, this text is usually typed rather than handwritten, making
it recognizable by optical character recognition (OCR) functions. Often,
this text is placed away from the center of the image, allowing for
clever cropping to eliminate it entirely in some datasets.</p>
<div id="challenge-getting-rid-of-identifying-burned-in-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-getting-rid-of-identifying-burned-in-data" class="callout-inner">
<h3 class="callout-title">Challenge: Getting rid of identifying burned in data</h3>
<div class="callout-content">
<p>An ultrasound (taken from the public internet on a creative commons
license lisence <a href="https://www.flickr.com/photos/jcarter/2461223727" class="external-link">here</a>.) must
be kept at it’s existing height and width dimensions. You should change
the image from RGB to grayscale for your operations. It can be opened as
follows:</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io, filters</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>image <span class="op">=</span> <span class="st">'data/anonym/identifiable_us.jpg'</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>io.imshow(image)</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>io.show()</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/identifiable_us.jpg" alt="Identifiable ultrasound" class="figure mx-auto d-block"><div class="figcaption">Image from flikr website published with a
permissive lisence.</div>
</figure><p>Write code for more than one approach to de-identify (remove the
annotations from) the ultrasound image data.</p>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1"> Show me the solution </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<p>The image has identifying metadata. You should identify not only the
name, but the date and place as problematic. You can take three
different approaches. One would be to mask the data, the other would be
to blur it, and finally you can just crop it out entirely. First we will
show a selectively blurred image:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="im">from</span> skimage.filters <span class="im">import</span> gaussian</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="im">from</span> skimage.color <span class="im">import</span> rgb2gray</span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>image_base <span class="op">=</span> io.imread(image)</span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>image_base <span class="op">=</span> rgb2gray(image_base)</span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a>sub_im <span class="op">=</span> image_base[<span class="dv">0</span>:<span class="dv">78</span>,:].copy()</span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a>blur_sub_im <span class="op">=</span> gaussian(sub_im, sigma<span class="op">=</span><span class="dv">9</span>)</span>
<span id="cb3-9"><a href="#cb3-9" tabindex="-1"></a>final_image <span class="op">=</span> np.zeros(image_base.shape)</span>
<span id="cb3-10"><a href="#cb3-10" tabindex="-1"></a>final_image[<span class="dv">0</span>:<span class="dv">78</span>,:] <span class="op">=</span> blur_sub_im</span>
<span id="cb3-11"><a href="#cb3-11" tabindex="-1"></a>final_image[<span class="dv">79</span>:,:]<span class="op">=</span> image_base[<span class="dv">79</span>:, :]</span>
<span id="cb3-12"><a href="#cb3-12" tabindex="-1"></a>io.imshow(final_image)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/blurred_us.png" alt="Non-Identifiable blurred ultrasound" class="figure mx-auto d-block"><div class="figcaption">Image after blurring in one area.</div>
</figure><p>We could have also just make a simple zero-mask:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>image_masked <span class="op">=</span> io.imread(image)</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>image_masked[<span class="dv">0</span>:<span class="dv">78</span>,:] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>io.imshow(image_masked)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/masked_us.png" alt="Non-Identifiable masked ultrasound" class="figure mx-auto d-block"><div class="figcaption">Image after masking in one area.</div>
</figure><p>Finally, you could always just chop off the offending part so to
speak, and resize. However if you examine the image when we try this
solution you should notice that the image has changed in aspect ratio,
thus pixels values have changed. This may not be the ideal solution for
situations when you want to maintain the exact image pixels. Nonetheless
you can crop and resize as below:</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="im">from</span> skimage.transform <span class="im">import</span> resize</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a>final_image<span class="op">=</span> image_base[<span class="dv">79</span>:, :]</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>final_image <span class="op">=</span> resize(final_image,image_base.shape)</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>io.imshow(final_image)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/resize_us1.png" alt="Non-Identifiable cropped ultrasound" class="figure mx-auto d-block"><div class="figcaption">Image after crop and resize.</div>
</figure></div>
</div>
</div>
</div>
<p>Note there are other valid solutions to getting rid of what is
identifying image data, but the first two shown (blurring and masking)
are very common and straightforward. You have now seen three approaches
to removing some of the visual data on a 2-D image. The same approaches
can be taken on a 3D image.</p>
<p>Let’s take another look at an image we used earlier:</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="im">import</span> SimpleITK <span class="im">as</span> sitk</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="im">from</span> skimage <span class="im">import</span> io</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="im">from</span> ipywidgets <span class="im">import</span> interact, fixed</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="im">from</span> IPython.display <span class="im">import</span> clear_output</span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>sag_image <span class="op">=</span>  sitk.ReadImage(<span class="st">"data/sitk/A1_grayT1.nrrd"</span>, sitk.sitkFloat32)</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>cor_image <span class="op">=</span> sitk.PermuteAxes(sag_image, [<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">0</span>])</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a><span class="co"># General display function for any two 3D images</span></span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="kw">def</span> display_images(image1_z, image2_z, image1_npa, image2_npa, title1<span class="op">=</span><span class="st">"Image 1"</span>, title2<span class="op">=</span><span class="st">"Image 2"</span>):</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a>    plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a>    </span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a>    <span class="co"># Display the first image</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb9-18"><a href="#cb9-18" tabindex="-1"></a>    plt.imshow(image1_npa[image1_z, :, :], cmap<span class="op">=</span>plt.cm.Greys_r)</span>
<span id="cb9-19"><a href="#cb9-19" tabindex="-1"></a>    plt.title(title1)</span>
<span id="cb9-20"><a href="#cb9-20" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb9-21"><a href="#cb9-21" tabindex="-1"></a>    </span>
<span id="cb9-22"><a href="#cb9-22" tabindex="-1"></a>    <span class="co"># Display the second image</span></span>
<span id="cb9-23"><a href="#cb9-23" tabindex="-1"></a>    plt.subplot(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>)</span>
<span id="cb9-24"><a href="#cb9-24" tabindex="-1"></a>    plt.imshow(image2_npa[image2_z, :, :], cmap<span class="op">=</span>plt.cm.Greys_r)</span>
<span id="cb9-25"><a href="#cb9-25" tabindex="-1"></a>    plt.title(title2)</span>
<span id="cb9-26"><a href="#cb9-26" tabindex="-1"></a>    plt.axis(<span class="st">'off'</span>)</span>
<span id="cb9-27"><a href="#cb9-27" tabindex="-1"></a>    </span>
<span id="cb9-28"><a href="#cb9-28" tabindex="-1"></a>    plt.show()</span>
<span id="cb9-29"><a href="#cb9-29" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" tabindex="-1"></a><span class="co"># Display the sagittal and coronal views of the original image</span></span>
<span id="cb9-31"><a href="#cb9-31" tabindex="-1"></a>interact(</span>
<span id="cb9-32"><a href="#cb9-32" tabindex="-1"></a>    display_images,</span>
<span id="cb9-33"><a href="#cb9-33" tabindex="-1"></a>    image1_z<span class="op">=</span>(<span class="dv">0</span>, sag_image.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb9-34"><a href="#cb9-34" tabindex="-1"></a>    image2_z<span class="op">=</span>(<span class="dv">0</span>, cor_image.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb9-35"><a href="#cb9-35" tabindex="-1"></a>    image1_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(sag_image)),</span>
<span id="cb9-36"><a href="#cb9-36" tabindex="-1"></a>    image2_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(cor_image)),</span>
<span id="cb9-37"><a href="#cb9-37" tabindex="-1"></a>    title1<span class="op">=</span>fixed(<span class="st">"Sagittal Cut"</span>),</span>
<span id="cb9-38"><a href="#cb9-38" tabindex="-1"></a>    title2<span class="op">=</span>fixed(<span class="st">"Coronal Cut"</span>)</span>
<span id="cb9-39"><a href="#cb9-39" tabindex="-1"></a>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/headcutsscroll.png" alt="Non-Identifiable head" class="figure mx-auto d-block"><div class="figcaption">Images of SITK head.</div>
</figure><p>Here we can see an analagous technique to one we used with the 2D
ultrasound. Identifying data (the nose and part of the ears) has been
cropped out.</p>
<div id="challenge-are-we-truly-deidentifiedoptional" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-are-we-truly-deidentifiedoptional" class="callout-inner">
<h3 class="callout-title">Challenge: Are we truly deidentified?(Optional)</h3>
<div class="callout-content">
<p>Look at the head MRI above. Are all such images, including CTs, with
some of the soft tissue stripped 100 percent deidentified? Give
arguments why and why not</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2"> Show me the solution </h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" data-bs-parent="#accordionSolution2" aria-labelledby="headingSolution2">
<div class="accordion-body">
<p>In most cases images like the above are de-identified. The image
above is only an image, not a DICOM with potentially identifying
metadata. Further we are missing the nose, therefore putting this in a
reverse look-up engine online will not yield identifying results. On the
other hand theoretically we could have an identifiable image. One
potentially identifiable case could be someone with a very identifiable
neck, skull bones (these will be more visible on CT) and/or ears.
Additionally in the case of patients who have had some kind of rare
pathology and surgery, they may still be identifiable for some familiar
with their cases.</p>
</div>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="faces-in-images">Faces in Images<a class="anchor" aria-label="anchor" href="#faces-in-images"></a></h3>
<p>A full CT, MRI, or PET scan of the head can be reconstructed into a
detailed facial image, potentially revealing the patient’s identity and
demographic information, such as ethnicity and gender. To mitigate this
risk, many image analysis programs employ ‘defacing’ techniques to
obscure these identifiable features.</p>
<p>We could in theory write our own defacing algorithm. For such an
algorithm libraries such as SITK or skimage (sci-kit image) or even
openCV provide several useful built in functions including <a href="reference.html#Morphological%20operations">morphological
operations</a> such as erosion, dilation, grow-from-seed and other types
of operations such as connected component analysis and masking. Which
library you choose will often be based on minimizing the number of
libraries in your total code, because mixing close libraries with
similarly named functions is a bad idea.</p>
<div id="challenge-soft-tissue-strippingoptional" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-soft-tissue-strippingoptional" class="callout-inner">
<h3 class="callout-title">Challenge: Soft tissue stripping(Optional)</h3>
<div class="callout-content">
<p>Look at the head MRI above. Try using SITK to get rid of some of the
soft tissue in the image (already loaded into sag_image).</p>
</div>
</div>
</div>
<div id="accordionSolution3" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution3" aria-expanded="false" aria-controls="collapseSolution3">
  <h4 class="accordion-header" id="headingSolution3"> Show me the solution </h4>
</button>
<div id="collapseSolution3" class="accordion-collapse collapse" data-bs-parent="#accordionSolution3" aria-labelledby="headingSolution3">
<div class="accordion-body">
<p>We can approach the problem in various ways. Below is one solution
with erosion, dilation and masking:</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Apply thresholding to remove soft tissues by first taking out the air then dilating and cleaning</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="co"># the assumption is that the black around the brain is zero and low values</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co"># Create the brain mask</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>lower_thresh <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>upper_thresh <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>brain_mask <span class="op">=</span> sitk.BinaryThreshold(sag_image, lowerThreshold<span class="op">=</span>lower_thresh, upperThreshold<span class="op">=</span>upper_thresh)</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co"># Morphological operations to clean the mask</span></span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>brain_mask_cleaned <span class="op">=</span> sitk.BinaryDilate(brain_mask, [<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>])</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>brain_mask_cleaned <span class="op">=</span> sitk.BinaryErode(brain_mask_cleaned, [<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>])</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a><span class="co"># Display the original and cleaned mask images using the general display function</span></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>interact(</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a>    display_images,</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a>    image1_z<span class="op">=</span>(<span class="dv">0</span>, brain_mask.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a>    image2_z<span class="op">=</span>(<span class="dv">0</span>, brain_mask_cleaned.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a>    image1_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(brain_mask)),</span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a>    image2_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(brain_mask_cleaned)),</span>
<span id="cb11-19"><a href="#cb11-19" tabindex="-1"></a>    title1<span class="op">=</span>fixed(<span class="st">"Original Mask"</span>),</span>
<span id="cb11-20"><a href="#cb11-20" tabindex="-1"></a>    title2<span class="op">=</span>fixed(<span class="st">"Cleaned Mask"</span>)</span>
<span id="cb11-21"><a href="#cb11-21" tabindex="-1"></a>)</span></code></pre>
</div>
<p>Then we can further clean with a connected component analysis that
throws out our small floaters, and use the inverse as out final
mask.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="kw">def</span> keep_largest_component(mask_image):</span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>    <span class="co"># Ensure mask_image is will work and use as little memory as possible </span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>    mask_image <span class="op">=</span> sitk.Cast(mask_image, sitk.sitkUInt8)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a>    </span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a>    <span class="co"># Label connected components in the mask image</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a>    labeled_image <span class="op">=</span> sitk.ConnectedComponent(mask_image)</span>
<span id="cb12-8"><a href="#cb12-8" tabindex="-1"></a>    </span>
<span id="cb12-9"><a href="#cb12-9" tabindex="-1"></a>    <span class="co"># Measure the size of each labeled component</span></span>
<span id="cb12-10"><a href="#cb12-10" tabindex="-1"></a>    label_shape_statistics <span class="op">=</span> sitk.LabelShapeStatisticsImageFilter()</span>
<span id="cb12-11"><a href="#cb12-11" tabindex="-1"></a>    label_shape_statistics.Execute(labeled_image)</span>
<span id="cb12-12"><a href="#cb12-12" tabindex="-1"></a>    </span>
<span id="cb12-13"><a href="#cb12-13" tabindex="-1"></a>    <span class="co"># Count and print the number of connected components</span></span>
<span id="cb12-14"><a href="#cb12-14" tabindex="-1"></a>    component_count <span class="op">=</span> <span class="bu">len</span>(label_shape_statistics.GetLabels())</span>
<span id="cb12-15"><a href="#cb12-15" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of connected components before filtering: </span><span class="sc">{</span>component_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-16"><a href="#cb12-16" tabindex="-1"></a>    </span>
<span id="cb12-17"><a href="#cb12-17" tabindex="-1"></a>    <span class="co"># Find the label with the largest size</span></span>
<span id="cb12-18"><a href="#cb12-18" tabindex="-1"></a>    largest_label <span class="op">=</span> <span class="bu">max</span>(</span>
<span id="cb12-19"><a href="#cb12-19" tabindex="-1"></a>        label_shape_statistics.GetLabels(),</span>
<span id="cb12-20"><a href="#cb12-20" tabindex="-1"></a>        key<span class="op">=</span><span class="kw">lambda</span> label: label_shape_statistics.GetPhysicalSize(label)</span>
<span id="cb12-21"><a href="#cb12-21" tabindex="-1"></a>    )</span>
<span id="cb12-22"><a href="#cb12-22" tabindex="-1"></a>    </span>
<span id="cb12-23"><a href="#cb12-23" tabindex="-1"></a>    <span class="co"># Create a new mask with only the largest component</span></span>
<span id="cb12-24"><a href="#cb12-24" tabindex="-1"></a>    largest_component_mask <span class="op">=</span> sitk.BinaryThreshold(labeled_image, lowerThreshold<span class="op">=</span>largest_label, upperThreshold<span class="op">=</span>largest_label, insideValue<span class="op">=</span><span class="dv">1</span>, outsideValue<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-25"><a href="#cb12-25" tabindex="-1"></a>    </span>
<span id="cb12-26"><a href="#cb12-26" tabindex="-1"></a>    <span class="co"># Verify the result by counting the components in the resulting image</span></span>
<span id="cb12-27"><a href="#cb12-27" tabindex="-1"></a>    labeled_result <span class="op">=</span> sitk.ConnectedComponent(largest_component_mask)</span>
<span id="cb12-28"><a href="#cb12-28" tabindex="-1"></a>    label_shape_statistics.Execute(labeled_result)</span>
<span id="cb12-29"><a href="#cb12-29" tabindex="-1"></a>    result_component_count <span class="op">=</span> <span class="bu">len</span>(label_shape_statistics.GetLabels())</span>
<span id="cb12-30"><a href="#cb12-30" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Number of connected components after filtering: </span><span class="sc">{</span>result_component_count<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb12-31"><a href="#cb12-31" tabindex="-1"></a>    </span>
<span id="cb12-32"><a href="#cb12-32" tabindex="-1"></a>    <span class="cf">return</span> largest_component_mask</span>
<span id="cb12-33"><a href="#cb12-33" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" tabindex="-1"></a>largest_component_mask <span class="op">=</span> keep_largest_component(brain_mask_cleaned)</span>
<span id="cb12-35"><a href="#cb12-35" tabindex="-1"></a><span class="co"># we actually want the opposite mask so we will invert the mask</span></span>
<span id="cb12-36"><a href="#cb12-36" tabindex="-1"></a>inverted_mask <span class="op">=</span> sitk.BinaryNot(largest_component_mask) </span>
<span id="cb12-37"><a href="#cb12-37" tabindex="-1"></a><span class="co"># Apply the mask to the image</span></span>
<span id="cb12-38"><a href="#cb12-38" tabindex="-1"></a>brain_only <span class="op">=</span> sitk.Mask(sag_image, inverted_mask)</span>
<span id="cb12-39"><a href="#cb12-39" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" tabindex="-1"></a>interact(</span>
<span id="cb12-41"><a href="#cb12-41" tabindex="-1"></a>    display_images,</span>
<span id="cb12-42"><a href="#cb12-42" tabindex="-1"></a>    image1_z <span class="op">=</span> (<span class="dv">0</span>,brain_only.GetSize()[<span class="dv">2</span>]<span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb12-43"><a href="#cb12-43" tabindex="-1"></a>    image2_z <span class="op">=</span> (<span class="dv">0</span>,largest_component_mask.GetSize()[<span class="dv">2</span>]<span class="op">-</span><span class="dv">1</span>),</span>
<span id="cb12-44"><a href="#cb12-44" tabindex="-1"></a>    image1_npa <span class="op">=</span> fixed(sitk.GetArrayViewFromImage(brain_only)),</span>
<span id="cb12-45"><a href="#cb12-45" tabindex="-1"></a>    image2_npa <span class="op">=</span> fixed(sitk.GetArrayViewFromImage(largest_component_mask)),</span>
<span id="cb12-46"><a href="#cb12-46" tabindex="-1"></a>    title1<span class="op">=</span>fixed(<span class="st">"new image"</span>),</span>
<span id="cb12-47"><a href="#cb12-47" tabindex="-1"></a>    title2<span class="op">=</span>fixed(<span class="st">"mask"</span>)</span>
<span id="cb12-48"><a href="#cb12-48" tabindex="-1"></a>    )</span>
<span id="cb12-49"><a href="#cb12-49" tabindex="-1"></a></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/our_cca_stripped.png" alt="Home-made deface" class="figure mx-auto d-block"><div class="figcaption">Our partial soft tissue stripping.</div>
</figure><p>Now you may notice that we put together and erosion and dilation, and
we could have used instead a closure. There are many ways to solve this
problem. An entirely different approach would be to use grow-from seed
as below (not this may take a while to execute):</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="kw">def</span> guess_seed_point(img):</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>   <span class="co">"""</span></span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="co">   This function guesses a seed point for the brain in the middle of the image, and returns some seed points.</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">   """</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>   possible_point <span class="op">=</span> img.GetSize()[<span class="dv">0</span>]<span class="op">//</span><span class="dv">2</span>, img.GetSize()[<span class="dv">1</span>]<span class="op">//</span><span class="dv">2</span>, img.GetSize()[<span class="dv">2</span>]<span class="op">//</span><span class="dv">2</span></span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>   <span class="co"># Get the pixel value at the potential location</span></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>   pixel_value <span class="op">=</span> img.GetPixel(<span class="op">*</span>possible_point)</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>   <span class="cf">if</span> pixel_value <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>       picked_point <span class="op">=</span> possible_point</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>   <span class="cf">else</span>:</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>       <span class="co"># just move over a bit and hope for better</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>       new_possible_point <span class="op">=</span> img.GetSize()[<span class="dv">0</span>]<span class="op">//</span><span class="dv">2</span> <span class="op">+</span> img.GetSize()[<span class="dv">0</span>]<span class="op">//</span><span class="dv">10</span> , img.GetSize()[<span class="dv">1</span>]<span class="op">//</span><span class="dv">2</span>, img.GetSize()[<span class="dv">2</span>]<span class="op">//</span><span class="dv">2</span></span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>       picked_point <span class="op">=</span> new_possible_point</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>   <span class="cf">return</span> picked_point</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a><span class="co"># do some reality check of a look at the value in your seed point  </span></span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>seed_point <span class="op">=</span> guess_seed_point(sag_image) </span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>pixel_value <span class="op">=</span> sag_image.GetPixel(seed_point)</span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a><span class="bu">print</span>(pixel_value)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="fl">394.37042236328125</span></span></code></pre>
</div>
<p>Grow from seed, then display:</p>
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>seed_point <span class="op">=</span> guess_seed_point(sag_image)  </span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>lower_threshold <span class="op">=</span> <span class="dv">370</span>   <span class="co"># lower threshold</span></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>upper_threshold <span class="op">=</span> <span class="dv">480</span>   <span class="co"># upper threshold</span></span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>seed_mask <span class="op">=</span> sitk.ConnectedThreshold(</span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>   sag_image, seedList<span class="op">=</span>[seed_point],</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>   lower<span class="op">=</span>lower_threshold,</span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>   upper<span class="op">=</span>upper_threshold)</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a><span class="co"># let's dilate up a bit</span></span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a>seed_mask<span class="op">=</span> sitk.BinaryDilate(seed_mask, [<span class="dv">5</span>, <span class="dv">5</span>, <span class="dv">5</span>])</span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a><span class="co"># apply the mask to the image</span></span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a>brain_only <span class="op">=</span> sitk.Mask(sag_image, seed_mask)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co"># display to see what happened</span></span>
<span id="cb16-16"><a href="#cb16-16" tabindex="-1"></a>interact(</span>
<span id="cb16-17"><a href="#cb16-17" tabindex="-1"></a>   display_images,</span>
<span id="cb16-18"><a href="#cb16-18" tabindex="-1"></a>   image1_z<span class="op">=</span>(<span class="dv">0</span>, sag_image.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb16-19"><a href="#cb16-19" tabindex="-1"></a>   image2_z<span class="op">=</span>(<span class="dv">0</span>, brain_only.GetSize()[<span class="dv">2</span>] <span class="op">-</span> <span class="dv">1</span>),</span>
<span id="cb16-20"><a href="#cb16-20" tabindex="-1"></a>   image1_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(sag_image)),</span>
<span id="cb16-21"><a href="#cb16-21" tabindex="-1"></a>   image2_npa<span class="op">=</span>fixed(sitk.GetArrayViewFromImage(brain_only)),</span>
<span id="cb16-22"><a href="#cb16-22" tabindex="-1"></a>   title1<span class="op">=</span>fixed(<span class="st">"Original"</span>),</span>
<span id="cb16-23"><a href="#cb16-23" tabindex="-1"></a>   title2<span class="op">=</span>fixed(<span class="st">"Seeded and Masked"</span>)</span>
<span id="cb16-24"><a href="#cb16-24" tabindex="-1"></a>)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code></code></pre>
</div>
<figure><img src="fig/grown_from_seed.png" alt="Home-made deface by grow from seed" class="figure mx-auto d-block"><div class="figcaption">Our grown from seed soft tissue stripping.</div>
</figure><p>In the two solutions above we made masks. They each have different
problems we can see. For example in the grown from seed images we
stripped out part of the genu and splenium of the corpus callosum not to
mention the entire pons. An alternative is that could also have used a
registered atlas as a mask. Regardless of the base algorithms we begin
with, if we want a better image, we can keep tinkering with our
algorithms.</p>
</div>
</div>
</div>
</div>
<p>In the provided solutions to the above optional challenge we didn’t
get rid of a lot of the neck, and had other issues. A different approach
we could have taken would have been to register the brain to a
brain-like shape and use this as a mask. Nonetheless the given solutions
shows two potential approaches to removing tissue (which could in some
cases lead to identification) you don’t want in an image. Many
researchers do not want to waste time optimizing a skull stripping
technique if this was not the research question, so they use a pre-made
technique.</p>
<p>There are various tools available for defacing head imaging, ranging
from fully developed software products like <a href="https://surfer.nmr.mgh.harvard.edu/" class="external-link">FreeSurfer</a>, which
includes built-in defacing capabilities, to specialized functions within
coding libraries. Some of these tools strip off all of the skull and
soft tissue which may be useful for analysis even if we don’t care about
deidentification e.g. if we only want to look at brain tissue.</p>
<p>Unfortunately a key issue under current investigation is that some
defacing algorithms may inadvertently alter more than just the facial
features. Emerging research suggests that these algorithms might also
affect the morphometry of the brain image. This could lead to the
unintended loss or distortion of critical data. Therefore, it is
advisable to proceed with caution and, whenever possible, compare the
original and defaced images to ensure that important information remains
intact and unaltered.</p>
<figure><img src="fig/deface-example.jpg" alt="Defacing examples" class="figure mx-auto d-block"><div class="figcaption">Image from “A reproducibility evaluation of the
effects of MRI defacing on brain segmentation” by Chenyu Gao, Bennett A.
Landman, Jerry L. Prince, and Aaron Carass. The preprint is available <a href="https://pubmed.ncbi.nlm.nih.gov/37293070/" class="external-link">here</a>.</div>
</figure></div>
<div class="section level3">
<h3 id="other-parts-of-images">Other Parts of Images<a class="anchor" aria-label="anchor" href="#other-parts-of-images"></a></h3>
<p>Patient identity can often be inferred with just a few pieces of
data. In some cases, a single piece of information can be enough to
track down a patient’s identity, especially if medical files are
accessible. For instance, a serial number or other identifying number on
a medical device may be traceable back to a specific patient.</p>
<p>In other situations, slightly more data might be required to identify
a patient. Some patients may wear unique jewelry, such as a MedicAlert
bracelet or necklace with initials or a name. While most routine
ambulatory images are taken without jewelry, in emergency situations,
medical personnel may not have had the time to remove these items. The
more data points we have on a patient, the easier it becomes to identify
them.</p>
<figure><img src="fig/jewellery_artifact.jpg" alt="jewlery artifact" class="figure mx-auto d-block"><div class="figcaption">Case courtesy of Ian Bickle,
<a href="https://radiopaedia.org/" class="external-link">Radiopaedia.org</a>. From the case
<a href="https://radiopaedia.org/cases/61830" class="external-link">rID: 61830</a>
</div>
</figure></div>
<div class="section level3">
<h3 id="metadata-1">Metadata<a class="anchor" aria-label="anchor" href="#metadata-1"></a></h3>
<p>Metadata is in the broadest sense data about our data. In the
practical sense we need to understand it is a place outside the image
that identifying data may be lurking in.</p>
<p>Various tools are available to help de-identify DICOM files in terms
of metadata. A notable one is <a href="https://github.com/KitwareMedical/dicom-anonymizer" class="external-link">DicomAnonymizer</a>,
an open-source tool written in Python.</p>
<p>In some cases, you may need to examine and remove metadata manually
or programmatically. For example, in some countries, DICOM fields are
used inconsistently, and patient-identifying data can appear in
unexpected fields. Therefore, careful examination and customized removal
of metadata may be necessary.</p>
<div id="many-ways-to-handle-a-dicom" class="callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="many-ways-to-handle-a-dicom" class="callout-inner">
<h3 class="callout-title">Many Ways to Handle a DICOM:</h3>
<div class="callout-content">
<ul><li>Multiple libraries, such as Pydicom and SimpleITK (SITK), allow you
to read, access, and manipulate DICOM metadata.</li>
<li>DICOMs follow an extremely complex <a href="https://www.dicomstandard.org/" class="external-link">standard</a>, so it is usually
better to use existing libraries rather than raw Python to handle
them.</li>
</ul></div>
</div>
</div>
<p>For various reasons, we may prefer Pydicom, SITK, or another method
to handle DICOM metadata, typically based on the principle of minimizing
dependencies and maintaining simplicity. SITK was introduced earlier in
this course. Pydicom is an excellent alternative, particularly because
of its comprehensive <a href="https://pydicom.github.io/pydicom/stable/" class="external-link">documentation</a>.</p>
<p>Now, let’s see how to open a DICOM file and work with it using
Pydicom.</p>
<p>First, let’s import Pydicom and read in a CT scan:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="im">import</span> pydicom</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a><span class="im">from</span> pydicom <span class="im">import</span> dcmread</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>fpath <span class="op">=</span> <span class="st">"data/anonym/our_sample_dicom.dcm"</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>ds <span class="op">=</span> dcmread(fpath)</span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a><span class="bu">print</span>(ds)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Dataset.file_meta -------------------------------
(0002, 0000) File Meta Information Group Length  UL: 218
(0002, 0001) File Meta Information Version       OB: b'\x00\x01'
(0002, 0002) Media Storage SOP Class UID         UI: CT Image Storage
(0002, 0003) Media Storage SOP Instance UID      UI: 1.3.46.670589.33.1.63849049636503447100001.4758671761353145811
(0002, 0010) Transfer Syntax UID                 UI: JPEG Lossless, Non-Hierarchical, First-Order Prediction (Process 14 [Selection Value 1])
(0002, 0012) Implementation Class UID            UI: 1.2.840.113845.1.1
(0002, 0013) Implementation Version Name         SH: 'Syn7,3,0,258'
(0002, 0016) Source Application Entity Title     AE: 'SynapseDicomSCP'
-------------------------------------------------
(0008, 0005) Specific Character Set              CS: 'ISO_IR 100'
(0008, 0008) Image Type                          CS: ['DERIVED', 'SECONDARY', 'MPR']
(0008, 0012) Instance Creation Date              DA: '20240418'
(0008, 0013) Instance Creation Time              TM: '150716.503'
(0008, 0016) SOP Class UID                       UI: CT Image Storage
(0008, 0018) SOP Instance UID                    UI: 1.3.46.670589.33.1.63849049636503447100001.4758671761353145811
(0008, 0020) Study Date                          DA: '20240418'
(0008, 0022) Acquisition Date                    DA: '20240418'
(0008, 0023) Content Date                        DA: '20240418'
(0008, 002a) Acquisition DateTime                DT: '20240418150313.020'
(0008, 0030) Study Time                          TM: '150045'
(0008, 0032) Acquisition Time                    TM: '150313'
(0008, 0033) Content Time                        TM: '150314.375'
(0008, 0050) Accession Number                    SH: '2001433888'
(0008, 0060) Modality                            CS: 'CT'
(0008, 0070) Manufacturer                        LO: 'Philips'
(0008, 0080) Institution Name                    LO: 'BovenIJ Ziekenhuis iCT'
(0008, 0081) Institution Address                 ST: ''
(0008, 0090) Referring Physician's Name          PN: 'WILTING^I^I^""'
(0008, 1010) Station Name                        SH: 'HOST-999999'
(0008, 1030) Study Description                   LO: 'CT thorax met iv contrast'
(0008, 103e) Series Description                  LO: 'Cor IMR med'
(0008, 1040) Institutional Department Name       LO: 'Radiology'
(0008, 1080) Admitting Diagnoses Description     LO: ''
(0008, 1084)  Admitting Diagnoses Code Sequence  0 item(s) ----
(0008, 1090) Manufacturer's Model Name           LO: 'iCT 256'
(0008, 1111)  Referenced Performed Procedure Step Sequence  1 item(s) ----
   (0008, 1150) Referenced SOP Class UID            UI: Modality Performed Procedure Step SOP Class
   (0008, 1155) Referenced SOP Instance UID         UI: 1.3.46.670589.33.1.63849049241567858000001.4675122277016890611
   ---------
(0008, 1140)  Referenced Image Sequence  1 item(s) ----
   (0008, 1150) Referenced SOP Class UID            UI: CT Image Storage
   (0008, 1155) Referenced SOP Instance UID         UI: 1.3.46.670589.33.1.63849049294969912500001.5475332148846191441
   ---------
(0008, 3010) Irradiation Event UID               UI: 1.3.46.670589.33.1.63849049343237673200010.5507538603167078985
(0010, 0010) Patient's Name                      PN: 'OurBeloved^Colleague'
(0010, 0020) Patient ID                          LO: 'party like 1999'
(0010, 0030) Patient's Birth Date                DA: '19421104'
(0010, 0040) Patient's Sex                       CS: 'M'
(0010, 1000) Other Patient IDs                   LO: '1989442112'
(0010, 1010) Patient's Age                       AS: '041Y'
(0018, 0010) Contrast/Bolus Agent                LO: 'Iodine'
(0018, 0015) Body Part Examined                  CS: 'CHEST'
(0018, 0022) Scan Options                        CS: 'HELIX'
(0018, 0050) Slice Thickness                     DS: '2.0'
(0018, 0060) KVP                                 DS: '100.0'
(0018, 0088) Spacing Between Slices              DS: '2.0'
(0018, 0090) Data Collection Diameter            DS: '500.0'
(0018, 1000) Device Serial Number                LO: ''
(0018, 1020) Software Versions                   LO: '4.1'
(0018, 1030) Protocol Name                       LO: 'Thorax std /Thorax'
(0018, 1040) Contrast/Bolus Route                LO: 'IV'
(0018, 1041) Contrast/Bolus Volume               DS: '80.0'
(0018, 1044) Contrast/Bolus Total Dose           DS: '40.0'
(0018, 1046) Contrast Flow Rate                  DS: [3, 3]
(0018, 1047) Contrast Flow Duration              DS: [17, 10]
(0018, 1049) Contrast/Bolus Ingredient Concentra DS: '300.0'
(0018, 1100) Reconstruction Diameter             DS: '348.0'
(0018, 1110) Distance Source to Detector         DS: '1040.0'
(0018, 1111) Distance Source to Patient          DS: '570.0'
(0018, 1120) Gantry/Detector Tilt                DS: '0.0'
(0018, 1130) Table Height                        DS: '85.1'
(0018, 1150) Exposure Time                       IS: '434'
(0018, 1151) X-Ray Tube Current                  IS: '258'
(0018, 1152) Exposure                            IS: '108'
(0018, 1160) Filter Type                         SH: 'IMR'
(0018, 1210) Convolution Kernel                  SH: 'IMR1,Soft Tissue'
(0018, 5100) Patient Position                    CS: 'FFS'
(0018, 9305) Revolution Time                     FD: 0.33
(0018, 9306) Single Collimation Width            FD: 0.625
(0018, 9307) Total Collimation Width             FD: 80.0
(0018, 9309) Table Speed                         FD: 185.0
(0018, 9310) Table Feed per Rotation             FD: 97.664
(0018, 9311) Spiral Pitch Factor                 FD: 0.763
(0018, 9345) CTDIvol                             FD: 4.330253533859318
(0018, a001)  Contributing Equipment Sequence  1 item(s) ----
   (0008, 0070) Manufacturer                        LO: 'PHILIPS'
   (0008, 0080) Institution Name                    LO: 'BRILLIANCE4'
   (0008, 0081) Institution Address                 ST: 'BRILLIANCE4'
   (0008, 1010) Station Name                        SH: 'HOST-999999'
   (0008, 1040) Institutional Department Name       LO: 'BRILLIANCE4'
   (0008, 1090) Manufacturer's Model Name           LO: 'BRILLIANCE4'
   (0018, 1000) Device Serial Number                LO: 'BRILLIANCE4'
   (0018, 1020) Software Versions                   LO: '4.5.0.30020'
   (0040, a170)  Purpose of Reference Code Sequence  1 item(s) ----
      (0008, 0100) Code Value                          SH: '109102'
      (0008, 0102) Coding Scheme Designator            SH: 'DCM'
      (0008, 0104) Code Meaning                        LO: 'Processing Equipment'
      ---------
   ---------
(0020, 000d) Study Instance UID                  UI: 1.3.46.670589.33.1.63849049241560857600001.4706589000974752499
(0020, 000e) Series Instance UID                 UI: 1.3.46.670589.33.1.63849049343237673200004.5226562961912261811
(0020, 0010) Study ID                            SH: '8041'
(0020, 0011) Series Number                       IS: '203'
(0020, 0012) Acquisition Number                  IS: '2'
(0020, 0013) Instance Number                     IS: '1'
(0020, 0032) Image Position (Patient)            DS: [-172.7884, 8.90000000000001, 1201.43792746114]
(0020, 0037) Image Orientation (Patient)         DS: [1, 0, 0, 0, 0, -1]
(0020, 0052) Frame of Reference UID              UI: 1.3.46.670589.33.1.63849049263758127200002.5362237490253193614
(0020, 1040) Position Reference Indicator        LO: ''
(0020, 4000) Image Comments                      LT: 'Cor IMR med'
(0028, 0002) Samples per Pixel                   US: 1
(0028, 0004) Photometric Interpretation          CS: 'MONOCHROME2'
(0028, 0010) Rows                                US: 832
(0028, 0011) Columns                             US: 772
(0028, 0030) Pixel Spacing                       DS: [0.4507772, 0.4507772]
(0028, 0100) Bits Allocated                      US: 16
(0028, 0101) Bits Stored                         US: 12
(0028, 0102) High Bit                            US: 11
(0028, 0103) Pixel Representation                US: 0
(0028, 1050) Window Center                       DS: [50, 50]
(0028, 1051) Window Width                        DS: [350, 350]
(0028, 1052) Rescale Intercept                   DS: '-1024.0'
(0028, 1053) Rescale Slope                       DS: '1.0'
(0032, 1033) Requesting Service                  LO: 'CHIPSOFT'
(0040, 1001) Requested Procedure ID              SH: 'CT5001IV'
(0054, 1001) Units                               CS: 'HU'
(00e1, 0010) Private Creator                     LO: 'ELSCINT1'
(00e1, 1036) Private tag data                    CS: 'YES'
(00e1, 1040) [Image Label]                       SH: 'Cor IMR med'
(00e1, 1046) Private tag data                    OB: Array of 512 elements
(01f1, 0010) Private Creator                     LO: 'ELSCINT1'
(01f1, 1001) [Acquisition Type]                  CS: 'SPIRAL'
(01f1, 1002) [Unknown]                           CS: 'STANDARD'
(01f1, 100e) [Unknown]                           FL: 0.0
(01f1, 1027) [Rotation Time]                     DS: '0.33'
(01f1, 1032) [Image View Convention]             CS: 'RIGHT_ON_LEFT'
(01f1, 104a) [Unknown]                           SH: 'DOM'
(01f1, 104b) [Unknown]                           SH: '128x0.625'
(01f1, 104d) [Unknown]                           SH: 'NO'
(01f1, 104e) [Unknown]                           SH: 'Chest'
(01f1, 1054) Private tag data                    IS: '11'
(01f1, 1056) Private tag data                    LO: '30.0451206729581'
(01f7, 0010) Private Creator                     LO: 'ELSCINT1'
(01f7, 1022) [Unknown]                           UI: 1.3.46.670589.33.1.63849049343237673200010.5507538603167078985
(07a1, 0010) Private Creator                     LO: 'ELSCINT1'
(07a1, 1010) [Tamar Software Version]            LO: '4.0.0'
(7fe0, 0010) Pixel Data                          OB: Array of 309328 elements</code></pre>
</div>
<div id="challenge-identifying-safe-metadata-in-dicom" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-identifying-safe-metadata-in-dicom" class="callout-inner">
<h3 class="callout-title">Challenge: Identifying Safe Metadata in DICOM</h3>
<div class="callout-content">
<p>Can you determine which metadata for this CT scan is likely safe,
meaning it does not lead to patient identification? When would you
choose to retain such data?</p>
</div>
</div>
</div>
<div id="accordionSolution4" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution4" aria-expanded="false" aria-controls="collapseSolution4">
  <h4 class="accordion-header" id="headingSolution4"> Show me the solution </h4>
</button>
<div id="collapseSolution4" class="accordion-collapse collapse" data-bs-parent="#accordionSolution4" aria-labelledby="headingSolution4">
<div class="accordion-body">
<p>Metadata related to the machine, image type, and file type are
generally safe. This information is particularly valuable when sorting
through numerous DICOM files to locate specific types of images or when
generating tabular data for harmonization purposes.</p>
</div>
</div>
</div>
</div>
<p>We can modify elements of our DICOM metadata:</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>elem <span class="op">=</span> ds[<span class="bn">0x0010</span>, <span class="bn">0x0010</span>]</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="bu">print</span>(elem.value)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code><span><span class="st">'OurBeloved^Colleague'</span></span></code></pre>
</div>
<div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>elem.value <span class="op">=</span> <span class="st">'Citizen^Almoni'</span></span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a><span class="bu">print</span>(elem)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(0010, 0010) Patient's Name                      PN: 'Citizen^Almoni'</code></pre>
</div>
<p>In some cases, as here we are dealing with a standard <a href="https://pydicom.github.io/pydicom/stable/reference/generated/pydicom.dataelem.DataElement.html#pydicom.dataelem.DataElement.keyword" class="external-link">keyword</a>.
The keyword <code>PatientName</code> is in programming terms technically
a property of the class <code>FileDataset</code>, but here we are using
“keyword” to refer to it and other very standard properties of the
DICOM. Certain keywords can be modified as it follows:</p>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>ds.PatientName <span class="op">=</span> <span class="st">'Almoni^Shmalmoni'</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="bu">print</span>(elem)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(0010, 0010) Patient's Name                      PN: 'Almoni^Shmalmoni' </code></pre>
</div>
<p>You can also just set an element to empty by using None:</p>
<div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>ds.PatientName <span class="op">=</span> <span class="va">None</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="bu">print</span>(elem)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>(0010, 0010) Patient's Name                      PN: None</code></pre>
</div>
<p>You can also delete and add elements. After making modifications,
remember to save your file:</p>
<div class="codewrapper sourceCode" id="cb28">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>ds.save_as(<span class="st">'data/anonym/my_modified_dicom.dcm'</span>)</span></code></pre>
</div>
<p>We recommend removing at least the patient IDs and birthdates in most
cases. Additionally, consider examining the data elements
‘OtherPatientIDs’ and ‘OtherPatientIDsSequence’.</p>
<div id="challenge-accessing-additional-patient-identifying-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-accessing-additional-patient-identifying-data" class="callout-inner">
<h3 class="callout-title">Challenge: Accessing Additional Patient Identifying Data</h3>
<div class="callout-content">
<p>How can you access and print additional patient identifying data?
Hint: Refer to the documentation and compare with what we have already
printed.</p>
</div>
</div>
</div>
<div id="accordionSolution5" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution5" aria-expanded="false" aria-controls="collapseSolution5">
  <h4 class="accordion-header" id="headingSolution5"> Show me the solution </h4>
</button>
<div id="collapseSolution5" class="accordion-collapse collapse" data-bs-parent="#accordionSolution5" aria-labelledby="headingSolution5">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb29">
<h3 class="code-label">PYTHON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode python" tabindex="0"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="bu">print</span>(ds.PatientBirthDate)</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="bu">print</span>(ds.PatientID)</span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="bu">print</span>(ds.OtherPatientIDs)</span>
<span id="cb29-4"><a href="#cb29-4" tabindex="-1"></a><span class="bu">print</span>(ds.PatientSex)</span>
<span id="cb29-5"><a href="#cb29-5" tabindex="-1"></a><span class="bu">print</span>(ds.PatientAge)</span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>19421104
party like 1999
1989442112
M
41Y</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>Pydicom offers a wide range of capabilities. You can visualize your
DICOM data in a hierarchical tree format for user-friendly GUI reading.
It supports downsizing images and handling waveform data such as EKGs.
By integrating with Matplotlib, you can load and plot files seamlessly.
Before adding additional libraries, explore Pydicom’s full potential to
leverage its extensive functionalities.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points</h3>
<div class="callout-content">
<ul><li>Certain metadata should almost always be removed from DICOM files
before sharing</li>
<li>Automated tools are available to strip metadata from DICOMs, but
manual verification is necessary due to inconsistencies in how fields
are utilized</li>
<li>Several Python libraries enable access to DICOM metadata</li>
<li>Sharing only image files such as JPEGs or NIfTI can mitigate risks
associated with metadata</li>
<li>Imaging data alone, even without explicit metadata, can sometimes
lead to patient identification</li>
<li>You may need to preprocess images themselves so patients are
de-identified</li>
<li>Tools exist to deface head images to further protect patient
identity</li>
</ul></div>
</div>
</div>
<!--
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use.
 -->
</div>
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="pathology.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="generative_ai.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="pathology.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Working with
        </a>
        <a class="chapter-link float-end" href="generative_ai.html" rel="next">
          Next: Generative AI in...
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>

        <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/edit/main/episodes/anonymization.md" class="external-link">Edit on GitHub</a>

	
        | <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/" class="external-link">Source</a></p>
				<p><a href="https://github.com/esciencecenter-digital-skills/medical-image-processing/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:doctormakeda@gmail.com">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">

        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>

        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.11" class="external-link">sandpaper (0.16.11)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.9" class="external-link">pegboard (0.7.9)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.5" class="external-link">varnish (1.0.5)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://esciencecenter-digital-skills.github.io/medical-image-processing/anonymization.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "python, software, lesson, medical images, DICOMs",
  "name": "Anonymizing Medical Images",
  "creativeWorkStatus": "active",
  "url": "https://esciencecenter-digital-skills.github.io/medical-image-processing/anonymization.html",
  "identifier": "https://esciencecenter-digital-skills.github.io/medical-image-processing/anonymization.html",
  "dateCreated": "2025-03-18",
  "dateModified": "2025-03-18",
  "datePublished": "2025-03-25"
}

  </script><script>
		feather.replace();
	</script></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

